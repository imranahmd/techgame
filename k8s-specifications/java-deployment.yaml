apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-deployment
  labels:
    app: backend
spec:
  replicas: 2
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:
      containers:
        - name: backend
          image: your-dockerhub-username/java-backend:latest
          ports:
            - containerPort: 8080
          env:
            - name: SPRING_DATASOURCE_URL
              value: jdbc:mysql://mysql-service:3306/your_database_name
            - name: SPRING_DATASOURCE_USERNAME
              valueFrom:
                secretKeyRef:
                  name: mysql-secret
                  key: username
            - name: SPRING_DATASOURCE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mysql-secret
                  key: password
            - name: SPRING_JPA_HIBERNATE_DDL_AUTO
              value: update
            - name: SERVER_PORT
              value: "8080"
          readinessProbe:
            httpGet:
              path: /actuator/health
              port: 8080
            initialDelaySeconds: 15
            periodSeconds: 10
          livenessProbe:
            httpGet:
              path: /actuator/health
              port: 8080
            initialDelaySeconds: 30
            periodSeconds: 20
      restartPolicy: Always



Detailed Explanation (Section-by-Section)
üß© 1Ô∏è‚É£ Basic Deployment Metadata
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-deployment
  labels:
    app: backend


apiVersion: apps/v1 ‚Üí Refers to Kubernetes API version for Deployment resources.

kind: Deployment ‚Üí Specifies this resource creates and manages a deployment (i.e., pod replicas).

metadata.name ‚Üí Human-readable name (backend-deployment).

labels ‚Üí Tags to identify the resource, used later by Services, Selectors, etc.

‚öôÔ∏è 2Ô∏è‚É£ Deployment Specification
spec:
  replicas: 2
  selector:
    matchLabels:
      app: backend


replicas: 2 ‚Üí Ensures two Pods of this backend will always run. (High availability)

selector.matchLabels ‚Üí The Service and Pod template must share these labels. It connects Pods to this Deployment.

üß† 3Ô∏è‚É£ Pod Template
template:
  metadata:
    labels:
      app: backend


Defines how the Pod inside the deployment should look.

Labels: Must match the selector (app: backend).

üì¶ 4Ô∏è‚É£ Container Specification
spec:
  containers:
    - name: backend
      image: your-dockerhub-username/java-backend:latest
      ports:
        - containerPort: 8080


name: backend ‚Üí Logical name of your container.

image: ‚Üí Docker image of your Spring Boot backend (stored in DockerHub or ECR).

containerPort: ‚Üí Internal port where your app runs (Spring Boot defaults to 8080).

üí° In AWS EKS, this image can be pulled from:

Docker Hub

Amazon ECR (preferred for production).

üîê 5Ô∏è‚É£ Environment Variables
env:
  - name: SPRING_DATASOURCE_URL
    value: jdbc:mysql://mysql-service:3306/your_database_name


This sets database configuration for your Spring Boot app.

SPRING_DATASOURCE_URL ‚Üí JDBC connection string to your MySQL service inside the same Kubernetes cluster.

mysql-service is the Kubernetes Service name of your MySQL database.

Port 3306 is MySQL‚Äôs default port.

Secure Credentials:
  - name: SPRING_DATASOURCE_USERNAME
    valueFrom:
      secretKeyRef:
        name: mysql-secret
        key: username


valueFrom.secretKeyRef ‚Üí Pulls sensitive values (username/password) from a Kubernetes Secret called mysql-secret.

‚ö° 6Ô∏è‚É£ Probes (Health Checks)
readinessProbe:
  httpGet:
    path: /actuator/health
    port: 8080
  initialDelaySeconds: 15
  periodSeconds: 10

livenessProbe:
  httpGet:
    path: /actuator/health
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 20


readinessProbe ‚Üí Checks when your app is ready to serve traffic.

livenessProbe ‚Üí Ensures the app is still alive. If it fails, Kubernetes restarts the container.

ü©∫ Both probes hit /actuator/health (Spring Boot actuator endpoint).

üëâ These improve uptime and auto-recovery in production.

üîÅ 7Ô∏è‚É£ Restart Policy
restartPolicy: Always


Ensures Kubernetes always restarts the Pod if it crashes.

Default for Deployments ‚Äî ensures reliability.

‚òÅÔ∏è How It Works in AWS EKS

This deployment runs two backend pods inside your EKS cluster.

Each pod connects to the MySQL service inside the cluster.

Kubernetes automatically restarts failed pods.

Health checks ensure zero-downtime restarts.

You can later scale easily:

kubectl scale deployment backend-deployment --replicas=4


Pods will be distributed across multiple EC2 worker nodes for redundancy.

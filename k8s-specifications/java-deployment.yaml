apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-deployment
  labels:
    app: backend
spec:
  replicas: 3  # Run 3 pods for high availability
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:
      containers:
        - name: backend
          image: <your-dockerhub-or-ecr-repo>/java-backend:latest
          ports:
            - containerPort: 8080
          env:
            - name: SPRING_DATASOURCE_URL
              value: jdbc:mysql://mysql-service:3306/your_database_name
            - name: SPRING_DATASOURCE_USERNAME
              valueFrom:
                secretKeyRef:
                  name: mysql-secret
                  key: username
            - name: SPRING_DATASOURCE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mysql-secret
                  key: password
            - name: SPRING_JPA_HIBERNATE_DDL_AUTO
              value: update
            - name: SERVER_PORT
              value: "8080"
          resources:
            requests:
              cpu: "250m"
              memory: "512Mi"
            limits:
              cpu: "500m"
              memory: "1Gi"
          readinessProbe:
            httpGet:
              path: /actuator/health
              port: 8080
            initialDelaySeconds: 15
            periodSeconds: 10
          livenessProbe:
            httpGet:
              path: /actuator/health
              port: 8080
            initialDelaySeconds: 30
            periodSeconds: 20
      restartPolicy: Always


Explanation (Production-Optimized Details)
üß© 1Ô∏è‚É£ apiVersion, kind, metadata
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-deployment
  labels:
    app: backend


Defines a Kubernetes Deployment resource for your Spring Boot backend, named backend-deployment, labeled for easy identification.

‚öôÔ∏è 2Ô∏è‚É£ Replica Strategy
replicas: 3


Runs 3 backend pods simultaneously ‚Üí ensures high availability and load balancing through your LoadBalancer service in AWS EKS.

If one pod or node fails, traffic automatically reroutes to others.

üéØ 3Ô∏è‚É£ Selector and Template
selector:
  matchLabels:
    app: backend
template:
  metadata:
    labels:
      app: backend


This connects your Service and Deployment ‚Äî only pods labeled app: backend are managed and load-balanced.

üì¶ 4Ô∏è‚É£ Container Configuration
containers:
  - name: backend
    image: <your-dockerhub-or-ecr-repo>/java-backend:latest


Replace <your-dockerhub-or-ecr-repo> with your actual image path, e.g.:

docker.io/imranahmd/java-backend:latest

or 123456789012.dkr.ecr.ap-south-1.amazonaws.com/java-backend:latest

EKS pulls this image automatically if your node IAM role has ECR permissions.

üîê 5Ô∏è‚É£ Environment Variables

These define your Spring Boot application‚Äôs database connection.

env:
  - name: SPRING_DATASOURCE_URL
    value: jdbc:mysql://mysql-service:3306/your_database_name


mysql-service ‚Üí Kubernetes service name for your MySQL DB.

Uses internal DNS to connect securely within the cluster.

The mysql-secret stores credentials:

  - name: SPRING_DATASOURCE_USERNAME
    valueFrom:
      secretKeyRef:
        name: mysql-secret
        key: username
  - name: SPRING_DATASOURCE_PASSWORD
    valueFrom:
      secretKeyRef:
        name: mysql-secret
        key: password


‚úÖ No hardcoded passwords ‚Äî Kubernetes Secrets handle this securely.

‚ö° 6Ô∏è‚É£ Resource Requests and Limits
resources:
  requests:
    cpu: "250m"
    memory: "512Mi"
  limits:
    cpu: "500m"
    memory: "1Gi"


requests ‚Üí Minimum guaranteed resources the pod will get.

limits ‚Üí Maximum the pod can consume.

This ensures your backend pods run efficiently and won‚Äôt exhaust node resources in production.

ü©∫ 7Ô∏è‚É£ Health Probes
readinessProbe:
  httpGet:
    path: /actuator/health
    port: 8080
  initialDelaySeconds: 15
  periodSeconds: 10

livenessProbe:
  httpGet:
    path: /actuator/health
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 20


Uses Spring Boot‚Äôs Actuator endpoint for health checks.

Ensures:

Pods only receive traffic once ready (readiness probe).

Unhealthy pods are restarted automatically (liveness probe).

These keep your application self-healing and stable.

üîÅ 8Ô∏è‚É£ Restart Policy
restartPolicy: Always


Ensures the backend container restarts automatically if it crashes or becomes unresponsive.

üß† Summary
Feature	Description
replicas: 3	High availability
env vars	Configures DB via secrets
probes	Auto health & restart
resources	Defines pod limits
LoadBalancer service	Connects external traffic
AWS ECR ready	Works directly in EKS
‚úÖ Deployment Commands

Once ready:

kubectl apply -f backend-deployment.yaml
kubectl apply -f backend-service.yaml


Check rollout:

kubectl get pods
kubectl get svc


You‚Äôll see an external ELB URL (e.g.):

a1b2c3d4e5f6g7.elb.amazonaws.com


That‚Äôs your public backend endpoint!
